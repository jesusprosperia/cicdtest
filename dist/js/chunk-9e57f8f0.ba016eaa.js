(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9e57f8f0"],{"02c0":function(e,t,r){"use strict";var n=r("b304"),s=r.n(n);s.a},"213c":function(e,t,r){"use strict";var n=r("bc0a"),s=r.n(n);s.a},"2f21":function(e,t,r){"use strict";var n=r("79e5");e.exports=function(e,t){return!!e&&n((function(){t?e.call(null,(function(){}),1):e.call(null)}))}},"469f":function(e,t,r){r("6c1c"),r("1654"),e.exports=r("7d7b")},"4f49":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",{staticClass:"manage-datasets"},[n("b-row",[n("div",{staticClass:"pl-0 org-card-wrapper"},[e.org?n("div",{staticClass:"org-card"},[n("b-card",{attrs:{title:e.org.name,"img-src":e.org.attrs.profile_img_url,"img-alt":e.org.name,"img-top":""}},[e.isOrgPage?e._e():n("p",{staticClass:"text-center mb-0 mt-1"},[e._v("\n              "+e._s(e.currentUserName)+"\n            ")])])],1):e._e()]),n("div",{staticClass:"schemes-and-datasets"},[n("block-container",{attrs:{title:e.userTrans.saved_targeting_scheme_title,fullWidth:!0}},[n("list",{attrs:{list:e.schemeList},scopedSlots:e._u([{key:"actions",fn:function(t){var s=t.datum;return[n("div",{staticClass:"icon mr-2",on:{click:function(t){return e.goToYourPopulation(s.id,s.name)}}},[n("img",{attrs:{src:r("eba5")}})]),e.userPermissions.delete_schemes?n("div",{staticClass:"icon",on:{click:function(t){return e.deleteScheme(s)}}},[n("img",{attrs:{src:r("d739")}})]):e._e()]}}])}),n("div",[e.userPermissions.create_schemes?n("b-button",{staticClass:"button-add",attrs:{variant:"success"},on:{click:e.addMoreScheme}},[e._v("\n              "+e._s(e.userTrans.craete_new_tar_scheme)+"\n            ")]):e._e(),e.userPermissions.copy_schemes?n("b-button",{staticClass:"ml-2 button-copy",attrs:{variant:"success"},on:{click:function(){return e.showCopySchemes=!0}}},[e._v("Copy Schemes")]):e._e()],1)],1),n("block-container",{attrs:{title:e.userTrans.available_datasets,fullWidth:!0}},[n("list",{attrs:{list:e.collectionList},scopedSlots:e._u([{key:"actions",fn:function(t){var s=t.datum;return[e.userPermissions.delete_datasets?n("div",{staticClass:"icon",on:{click:function(t){return e.deleteDataset(s.collection)}}},[n("img",{attrs:{src:r("d739")}})]):e._e()]}}])}),n("div",[e.userPermissions.create_datasets?n("b-button",{staticClass:"button-add",attrs:{variant:"success"},on:{click:e.addMoreDataset}},[e._v(e._s(e.userTrans.upload_new_dataset))]):e._e()],1)],1)],1)]),e.showUsers?n("block-container",{attrs:{title:"Users",fullWidth:!0}},[e.users?n("UsersTable",{attrs:{users:e.users}}):e._e()],1):e._e(),e.userPermissions.create_schemes?n("SchemeModal",{attrs:{show:e.showSchemeModal},on:{"on-cancel":function(){return e.showSchemeModal=!1},"on-save":e.onSchemeSave}}):e._e(),e.userPermissions.create_datasets?n("DatasetModal",{attrs:{show:e.showDatasetModal,sectionMap:e.sectionMap},on:{"on-cancel":e.onDatasetCancel,"on-save":e.onDatasetCancel,"on-more-click":e.onMoreClick,"on-uploaded":e.onDatasetUploaded}}):e._e(),e.userPermissions.create_datasets&&e.currentModalVariable&&e.currentCollection?n("MoreModal",{attrs:{show:e.showMoreModal,field:e.currentModalVariable,collectionName:e.currentCollection,sections:e.sections,xExtent:e.xExtent,yExtent:e.yExtent},on:{"on-cancel":function(){return e.showMoreModal=!1}}}):e._e(),e.userPermissions.copy_schemes?n("CopySchemes",{attrs:{show:e.showCopySchemes,org:e.org},on:{"on-cancel":function(){return e.showCopySchemes=!1}}}):e._e()],1)},s=[],a=(r("8e6e"),r("ac6a"),r("456d"),r("28a5"),r("96cf"),r("3b8d")),i=(r("7f7f"),r("bd86")),o=r("2f62"),c=r("f9be"),l=r("529c"),u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-modal",{attrs:{size:"lg","no-close-on-esc":"","no-close-on-backdrop":"","hide-header-close":""},scopedSlots:e._u([{key:"modal-footer",fn:function(){return[r("div",{staticClass:"w-100"},[e.schemeName?r("b-button",{staticClass:"float-right",attrs:{variant:"success",size:"sm"},on:{click:function(t){return e.onSave()}}},[e._v("Save")]):e._e(),r("b-button",{staticClass:"float-right mr-3",attrs:{variant:"light",size:"sm"},on:{click:function(t){return e.$emit("on-cancel")}}},[e._v("Cancel")])],1)]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[r("div",[r("b-form-group",{attrs:{label:"Name the target scheme:","label-cols":"4"}},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.schemeName,expression:"schemeName"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.schemeName},on:{input:function(t){t.target.composing||(e.schemeName=t.target.value)}}})])],1)])},d=[],h={name:"SchemeModal",props:{show:{type:Boolean,required:!0}},data:function(){return{schemeName:""}},methods:{onSave:function(){this.schemeName&&this.$emit("on-save",this.schemeName)}}},f=h,p=r("2877"),m=Object(p["a"])(f,u,d,!1,null,null,null),b=m.exports,g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-modal",{staticClass:"dataset",attrs:{size:"xl","no-close-on-esc":"","no-close-on-backdrop":"","hide-header-close":""},scopedSlots:e._u([{key:"modal-footer",fn:function(){return[n("div",{staticClass:"w-100"},[e.variables&&!e.uploading?n("b-button",{staticClass:"float-right",attrs:{variant:"success",size:"sm"},on:{click:e.onSave}},[e._v("Save")]):e._e(),n("b-button",{staticClass:"float-right mr-3",attrs:{variant:"light",size:"sm"},on:{click:e.onCancelDatasetModal}},[e._v("Cancel")])],1)]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[n("b-form-group",{attrs:{label:e.userTrans.upload_file,"label-cols":"4"}},[n("b-form-file",{attrs:{"browse-text":e.userTrans.browse_txt,state:Boolean(e.file),"drop-placeholder":e.userTrans.drop_file,placeholder:e.userTrans.choose_file,accept:".csv"},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}})],1),e.file?n("div",[n("b-form-group",{staticClass:"uploader",attrs:{label:e.userTrans.name_the_dataset,"label-cols":"4"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.datasetName,expression:"datasetName"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.datasetName},on:{input:function(t){t.target.composing||(e.datasetName=t.target.value)}}}),e.datasetName?n("b-button",{staticClass:"float-right ml-2 upload-btn",attrs:{variant:"success",size:"sm"},on:{click:e.handleFileUpload}},[e._v(e._s(e.userTrans.upload_text))]):e._e()],1)],1):e._e(),n("div",{staticClass:"form-row"},[n("div",{staticClass:"col-4"}),n("div",{staticClass:"col"},[e.progress?n("b-progress",{attrs:{value:e.progress,max:100,"show-progress":"",animated:"",variant:"success"}}):e._e(),n("b-alert",{attrs:{variant:"success",show:e.showSuccessMessage}},[e._v("\n          "+e._s(e.userTrans.upload_successful)+"\n      ")]),n("b-alert",{attrs:{variant:"danger",show:e.showErrorMessage}},[e._v("\n          "+e._s(e.userTrans.upload_failed)+"\n      ")])],1)]),e.variables&&!e.uploading?n("div",[n("b-form-group",{attrs:{label:e.userTrans.classify_variables,"label-cols":"4"}},[n("div",{staticClass:"matrix"},[n("table",{staticClass:"table"},[n("thead",[n("tr",[n("th"),n("th",[e._v(e._s(e.userTrans.numeric))]),n("th",[e._v(e._s(e.userTrans.categorical))]),n("th",[e._v(e._s(e.userTrans.factor_column))]),n("th",[e._v(e._s(e.userTrans.statistic_column))]),n("th",[e._v(e._s(e.userTrans.weight_column))]),n("th",{staticClass:"red"},[e._v(e._s(e.userTrans.ignore))]),n("th")])]),n("tbody",e._l(e.variables,(function(t,s){return n("tr",{key:"d-"+s},[n("th",{staticClass:"row-header"},[e._v(e._s(t.propName))]),n("td",[n("b-form-radio",{attrs:{name:t.propName,value:"numeric"},model:{value:t.category,callback:function(r){e.$set(t,"category",r)},expression:"d.category"}})],1),n("td",[n("b-form-radio",{attrs:{name:t.propName,value:"categorical"},model:{value:t.category,callback:function(r){e.$set(t,"category",r)},expression:"d.category"}})],1),n("td",[n("b-form-radio",{attrs:{name:t.propName,value:"factor"},model:{value:t.category,callback:function(r){e.$set(t,"category",r)},expression:"d.category"}})],1),n("td",[n("b-form-radio",{attrs:{name:t.propName,value:"statistic"},model:{value:t.category,callback:function(r){e.$set(t,"category",r)},expression:"d.category"}})],1),n("td",[n("b-form-radio",{attrs:{name:t.propName,value:"weight"},model:{value:t.category,callback:function(r){e.$set(t,"category",r)},expression:"d.category"}})],1),n("td",[n("b-form-radio",{attrs:{name:t.propName,value:"ignore",checked:"checked"},model:{value:t.category,callback:function(r){e.$set(t,"category",r)},expression:"d.category"}})],1),n("td",[n("b-button",{staticClass:"more-btn",attrs:{size:"sm",variant:"light"},on:{click:function(r){return e.$emit("on-more-click",t)}}},[n("img",{attrs:{src:r("f51c")}})])],1)])})),0)])])])],1):e._e()],1)},v=[],y=(r("5df3"),r("7f8c")),_={},w={},x=34,O=10,M=13;function C(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+"]"})).join(",")+"}")}function U(e,t){var r=C(e);return function(n,s){return t(r(n),s,e)}}function j(e){var t=Object.create(null),r=[];return e.forEach((function(e){for(var n in e)n in t||r.push(t[n]=n)})),r}function k(e,t){var r=e+"",n=r.length;return n<t?new Array(t-n+1).join(0)+r:r}function S(e){return e<0?"-"+k(-e,6):e>9999?"+"+k(e,6):k(e,4)}function E(e){var t=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),s=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":S(e.getUTCFullYear(),4)+"-"+k(e.getUTCMonth()+1,2)+"-"+k(e.getUTCDate(),2)+(s?"T"+k(t,2)+":"+k(r,2)+":"+k(n,2)+"."+k(s,3)+"Z":n?"T"+k(t,2)+":"+k(r,2)+":"+k(n,2)+"Z":r||t?"T"+k(t,2)+":"+k(r,2)+"Z":"")}var P=function(e){var t=new RegExp('["'+e+"\n\r]"),r=e.charCodeAt(0);function n(e,t){var r,n,a=s(e,(function(e,s){if(r)return r(e,s-1);n=e,r=t?U(e,t):C(e)}));return a.columns=n||[],a}function s(e,t){var n,s=[],a=e.length,i=0,o=0,c=a<=0,l=!1;function u(){if(c)return w;if(l)return l=!1,_;var t,n,s=i;if(e.charCodeAt(s)===x){while(i++<a&&e.charCodeAt(i)!==x||e.charCodeAt(++i)===x);return(t=i)>=a?c=!0:(n=e.charCodeAt(i++))===O?l=!0:n===M&&(l=!0,e.charCodeAt(i)===O&&++i),e.slice(s+1,t-1).replace(/""/g,'"')}while(i<a){if((n=e.charCodeAt(t=i++))===O)l=!0;else if(n===M)l=!0,e.charCodeAt(i)===O&&++i;else if(n!==r)continue;return e.slice(s,t)}return c=!0,e.slice(s,a)}e.charCodeAt(a-1)===O&&--a,e.charCodeAt(a-1)===M&&--a;while((n=u())!==w){var d=[];while(n!==_&&n!==w)d.push(n),n=u();t&&null==(d=t(d,o++))||s.push(d)}return s}function a(t,r){return t.map((function(t){return r.map((function(e){return u(t[e])})).join(e)}))}function i(t,r){return null==r&&(r=j(t)),[r.map(u).join(e)].concat(a(t,r)).join("\n")}function o(e,t){return null==t&&(t=j(e)),a(e,t).join("\n")}function c(e){return e.map(l).join("\n")}function l(t){return t.map(u).join(e)}function u(e){return null==e?"":e instanceof Date?E(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:n,parseRows:s,format:i,formatBody:o,formatRows:c}},N=P(","),T=N.parse,A=(N.parseRows,N.format,N.formatBody,N.formatRows,P("\t"));A.parse,A.parseRows,A.format,A.formatBody,A.formatRows;function $(e){var t=0,r="",n="";function s(s){"\n"===s[0]&&(s=s.substr(1)),"\n"==s[s.length-1]&&(s=s.substr(0,s.length-1));var a,i=s.indexOf("\n"),o=s.lastIndexOf("\n"),c="",l="";if(0==t&&i>-1&&(r=s.slice(0,i)),t&&i>-1&&(l=s.slice(0,i)),n.length&&l.length){var u=n.split(","),d=l.split(",");u.length+d.length-1==r.split(",").length?c=n+l:u.length==d.length&&(c=n+"\n"+l)}return o>-1&&t<e-1&&(n=s.slice(o+1),s=s.slice(0,o)),t&&i>-1&&(s=s.slice(i+1)),c.length&&(s=c+"\n"+s),t&&r.length&&(s=r+"\n"+s),""!=r&&s.length!=r.length&&(a=T(s),t++),a}return s}function D(e,t){var r="undefined"===typeof t?{}:t,n=e.size,s="undefined"===typeof r["chunk_size"]?65536:parseInt(r["chunk_size"]),a="undefined"!==typeof r["binary"]&&1==r["binary"],i=0,o=0,c=null,l="function"===typeof r["chunk_read_callback"]?r["chunk_read_callback"]:function(){},u="function"===typeof r["error_callback"]?r["error_callback"]:function(){},d="function"===typeof r["success"]?r["success"]:function(){},h=$(Math.ceil(n/s)),f=function(t){if(null==t.target.error){i=++o*s;var r=h(t.target.result);l(r,Math.min(i/n,1),o,(function(){i>=n?d(e):c(i,s,e)}))}else u(t.target.error)};c=function(e,t,r){var n=new FileReader,s=r.slice(e,t+e);n.onload=f,a?n.readAsArrayBuffer(s):n.readAsText(s)},c(i,s,e)}var z=r("9fb0"),R=r("be3b");function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){Object(i["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Y={name:"DatasetModal",mixins:[y["a"]],props:{show:{type:Boolean,required:!0},sectionMap:{type:Object,required:!0}},data:function(){return{file:null,datasetName:"",canceled:!1,variables:null,currentColletion:null,progress:0,uploading:!1,showSuccessMessage:!1,showErrorMessage:!1,chunkSize:262144}},computed:F(F({},Object(o["c"])(["userSettings"])),{},{uniqueCollection:function(){return"data_".concat(this.datasetName.split(" ").join("_"),"_").concat(Object(l["e"])())},user_id:function(){return this.$route.params.ref_id}}),methods:F(F({},Object(o["b"])(["addSchemeOrCol","removeCollection"])),{},{onCancelDatasetModal:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.variables||this.uploading){e.next=6;break}return e.next=3,this.$dialog.confirm({title:"Are you sure you want to cancel? The dataset will be removed. Please save to keep it!"});case 3:if(t=e.sent,t){e.next=6;break}return e.abrupt("return");case 6:if(this.uploading&&(this.canceled=!0),!this.currentColletion){e.next=11;break}return e.next=10,this.removeCollection({collection:this.currentColletion,user_id:this.user_id});case 10:this.currentColletion=null;case 11:this.showErrorMessage=!1,this.showSuccessMessage=!1,this.file=null,this.variables=null,this.datasetName="",this.$emit("on-cancel");case 17:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onSave:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r,n,s,a,i,o,c,l,u=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.variables.filter((function(e){return"ignore"!==e.category})),0!==t.length){e.next=3;break}return e.abrupt("return",this.flash(this.userTrans.no_variables_warning,"error"));case 3:if(1===t.filter((function(e){return"weight"===e.category})).length){e.next=5;break}return e.abrupt("return",this.flash(this.userTrans.no_weight_warning,"error"));case 5:return this.$store.commit(z["a"],!0),r=this.uniqueCollection,e.next=9,this.getFilters(t.filter((function(e){return"numeric"===e.category||"categorical"===e.category})));case 9:return n=e.sent,s=this.variables.filter((function(e){return"numeric"===e.category})),a=this.variables.filter((function(e){return"categorical"===e.category})),i=[],o=[],s.forEach((function(e){var t=u.sectionMap[e.propName];t&&(i.push({sections:t.sections,variable:t.variable}),o.push({xExtent:t.xExtent,yExtent:t.yExtent,variable:t.variable}))})),c=[],a.forEach((function(e){u.sectionMap[e.propName]&&c.push({collection:u.sectionMap[e.propName].shapeFile,variable:e.propName})})),l={collection:{name:this.datasetName,collection:r,variables:t,filters:n,sections:i,extents:o,shapeFiles:c}},this.user_id&&(l.user_id=this.user_id),e.next=21,this.addSchemeOrCol(l);case 21:this.$store.commit(z["a"],!1),this.file=null,this.variables=null,this.currentColletion=null,this.showSuccessMessage=!1,this.showErrorMessage=!1,this.datasetName="",this.$emit("on-save");case 29:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getFilters:function(e){var t=this;return Promise.all(e.map((function(e){return R["a"].post("/api/collection/get-filters",{filter:e,collection:t.uniqueCollection})}))).then((function(t){var r=[];return t.map((function(e){return e.data})).forEach((function(t,n){var s=e[n];if("numeric"===s.category)r.push({type:"numerical",text:s.propName,value:s.propName,min:t[0].min,max:t[0].max});else if("categorical"===s.category){var a=t.map((function(e){return e._id}));r.push({type:"categorical",text:s.propName,value:s.propName,values:a})}})),r}))},uploadChunk:function(e,t){return this.currentColletion=t,e.forEach((function(e){Object.keys(e).forEach((function(t){var r=e[t];isNaN(r)||(e[t]=+r)}))})),R["a"].post("/api/collection/upload",{data:e,collection:t})},handleFileUpload:function(){var e=this,t=this.file,r=this;if(t){var n=this.userSettings.max_dataset_size;if(t.size>1048576*n)return this.flash("File size exceeds ".concat(n," megabytes"),"error");this.uploading=!0,this.showSuccessMessage=!1,D(t,{chunk_size:this.chunkSize,chunk_read_callback:function(t,r,n,s){if(t.length){if(1==n){var a=Object.keys(t[0]).filter((function(e){return e.length}));e.variables=a.map((function(e){return{propName:e,category:"weight"===e?"weight":"ignore"}}))}e.progress=100*r,e.uploadChunk(t,e.uniqueCollection).then((function(){if(e.canceled)throw new Error;s()})).catch(e.errorCallback)}},success:function(){r.showSuccessMessage=!0,r.progress=0,r.uploading=!1,r.$emit("on-uploaded",{collection:r.uniqueCollection})},error_callback:this.errorCallback})}},errorCallback:function(){this.progress=0,this.uploading=!1,this.variables=null,this.showSuccessMessage=!1,this.showErrorMessage=!0,this.canceled=!1,this.file=null}})},L=Y,I=(r("affe"),Object(p["a"])(L,g,v,!1,null,null,null)),B=I.exports,V=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-modal",{attrs:{"no-close-on-esc":"","no-close-on-backdrop":"","hide-header-close":"",size:"xl"},scopedSlots:e._u([{key:"modal-footer",fn:function(){return[r("div",{staticClass:"w-100"},[r("b-button",{staticClass:"float-right",attrs:{variant:"success",size:"sm"},on:{click:function(t){return e.onSave()}}},[e._v("\n        Ok\n      ")]),r("b-button",{staticClass:"float-right mr-3",attrs:{variant:"light",size:"sm"},on:{click:function(t){return e.$emit("on-cancel")}}},[e._v("\n        Cancel\n      ")])],1)]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[r("div",{staticClass:"modal-inner-content"},[r("div",{staticClass:"top-switch"},[r("div",{staticClass:"tab-switcher"},[e.field&&"numeric"===e.field.category?r("div",{class:"w-50 text-center "+("sections"==e.view?"active":""),on:{click:function(t){e.view="sections"}}},[e._v("\n          Define Sections\n        ")]):e._e(),e.field&&"categorical"===e.field.category?r("div",{class:"w-50 text-center "+("map"==e.view?"active":""),on:{click:function(t){e.view="map"}}},[e._v("\n          Geographic visualization\n        ")]):e._e()])]),e.field&&"numeric"===e.field.category?r("Sections",{directives:[{name:"show",rawName:"v-show",value:"sections"===e.view,expression:"view === 'sections'"}],attrs:{currentSections:e.currentSections,propName:e.field.propName,collectionName:e.collectionName},on:{"sections-updated":e.onSectionsUpdate}}):e._e(),e.field&&"categorical"===e.field.category?r("Mapviz",{directives:[{name:"show",rawName:"v-show",value:"map"===e.view,expression:"view === 'map'"}],attrs:{field:e.field,collectionName:e.collectionName},on:{"on-save":function(t){return e.shapeFile=t}}}):e._e()],1)])},W=[],X=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"map-viz"},[r("b-form-group",[r("div",{staticClass:"d-flex align-items-center",attrs:{id:""}},[r("div",{staticClass:"upload-label",staticStyle:{"min-width":"100px"}},[r("span",[e._v("\n          "+e._s(e.userTrans.add_shapefile)+"\n        ")]),r("span",{attrs:{id:"dataset_upload_info"}},[r("svg",{staticClass:"bi bi-info-circle",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[r("path",{attrs:{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}}),r("path",{attrs:{d:"M8.93 6.588l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"}})])])]),r("b-form-file",{attrs:{"browse-text":e.userTrans.browse_txt,state:Boolean(e.file),"drop-placeholder":e.userTrans.drop_file,placeholder:e.userTrans.choose_file,accept:".geojson, .json"},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}}),e.file?r("b-button",{staticClass:"float-right ml-2 upload-btn",attrs:{variant:"success"},on:{click:e.handleFileUpload}},[e._v(e._s(e.userTrans.upload_text))]):e._e()],1)]),r("div",[r("b-alert",{attrs:{variant:"success",show:e.showSuccessMessage}},[e._v("\n      "+e._s(e.userTrans.upload_successful)+"\n    ")]),r("b-alert",{attrs:{variant:"danger",show:!1!==e.showErrorMessage}},[e._v("\n      "+e._s(e.showErrorMessage)+"\n    ")])],1)],1)},H=[],J=r("5ccb"),G=r.n(J),Z={props:{field:{type:Object,required:!0},collectionName:{type:String,required:!0}},mixins:[y["a"]],data:function(){return{file:null,showSuccessMessage:!1,showErrorMessage:!1}},computed:{uniqueCollection:function(){var e=this.file?this.file.name:"";return e=e.slice(0,e.lastIndexOf(".")),"shapefile_".concat(e.split(" ").join("_"),"_").concat(Object(l["e"])())}},methods:{handleFileUpload:function(){var e=this;this.file&&this.uniqueCollection&&this.file.text().then((function(t){var r=JSON.parse(t);if(r.features){var n=G()(r,!0),s=n.features,a=void 0===s?[]:s;a.length&&R["a"].post("/api/collection/get-filters",{filter:e.field,collection:e.collectionName}).then((function(t){var r=t.data.map((function(e){return e._id})),n=a.map((function(e){return e.properties.name}));r.some((function(e){return-1===n.indexOf(e)}))?e.showErrorMessage="Shapefile does not have required properties. Name column of the shapefile should coincide with the categories of [segmentation variable name]":e.upload(a)})).catch((function(t){e.showErrorMessage=t.message}))}})).catch((function(t){e.showErrorMessage=t.message}))},upload:function(e){var t=this,r=this.uniqueCollection;return R["a"].post("/api/collection/upload",{data:e,collection:r}).then((function(){t.showSuccessMessage=!0,t.showErrorMessage=!1,t.$emit("on-save",r)})).catch((function(e){t.showErrorMessage=e.message}))}},mounted:function(){this.$tippy(this.$el.querySelector("#dataset_upload_info"),{allowHTML:!0,content:this.userTrans.geojson_info_btn,maxWidth:300,interactive:!0})}},K=Z,Q=Object(p["a"])(K,X,H,!1,null,null,null),ee=Q.exports,te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sections"},[n("div",{staticClass:"add-new-sections"},[n("div",{staticClass:"sections-list"},[n("div",{staticClass:"list"},e._l(e.sections,(function(t,s){return n("div",{key:"section-"+s,staticClass:"list-item"},[n("div",{staticClass:"dataset-name d-flex align-items-center"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"d.name"}],staticClass:"form-control flex-grow-1 section-input",attrs:{type:"text",placeholder:"Please name the section",maxlength:"5"},domProps:{value:t.name},on:{input:[function(r){r.target.composing||e.$set(t,"name",r.target.value)},function(r){return e.onSectionUpdate(t)}]}}),n("span",{staticClass:"ml-2 mr-2"},[e._v("Below:")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"d.value"}],staticClass:"form-control value-input section-input",attrs:{min:e.xExtent[0],max:e.xExtent[1],type:"number"},domProps:{value:t.value},on:{input:[function(r){r.target.composing||e.$set(t,"value",r.target.value)},function(r){return e.onSectionUpdate(t)}]}})]),n("div",{staticClass:"delete-icon",on:{click:function(r){return e.deleteSection(t)}}},[n("img",{attrs:{src:r("d739")}})])])})),0)]),n("div",[n("b-button",{staticClass:"button-add",attrs:{variant:"success"},on:{click:function(t){return e.addNewSection()}}},[e._v("Add New Section")])],1)]),e.data?[n("div",{staticClass:"chart-row"},[n("div",{staticClass:"y-axis-extent"},[n("VueSlider",{attrs:{tooltip:"always",direction:"btt",step:1,min:0,max:e.dataYMaxRaw,height:216,"tooltip-formatter":e.formatNum},model:{value:e.dataYMax,callback:function(t){e.dataYMax=t},expression:"dataYMax"}})],1),n("div",{ref:"chart",staticClass:"chart-area"})]),n("div",{staticClass:"x-axis-extent"},[n("VueSlider",{attrs:{tooltip:"always","enable-cross":!1,"tooltip-merge":!1,step:1,min:e.dataMinRaw,max:e.dataMaxRaw},model:{value:e.xExtent,callback:function(t){e.xExtent=t},expression:"xExtent"}})],1)]:e._e()],2)},re=[],ne=(r("f400"),r("768b")),se=r("c9d9"),ae=r("c33f"),ie=(r("55dd"),r("823f")),oe=r("00a5"),ce=r("f3d3"),le=r("4611"),ue=r("ce24"),de=r("7618"),he=r("009f"),fe=r("e24e"),pe=r("eecc");function me(e){var t,r,n,s,a=e.width||400,i=e.height||8,o=e.container,c=e.sections||[],l=e.scale,u=l.domain(),d=l.bandwidth(),h=function(){};function f(){var r=[0,-i/2],c=a,l=30,u=a,d=8;return t=o.append("g").attr("class","slider").attr("transform","translate(".concat(e.x||0,", ").concat(e.y||0,")")).attr("opacity",e.visible?1:0).attr("pointer-events",e.visible?"all":"none"),n=t.append("g").attr("transform","translate(".concat(r,")")),s=n.append("rect").attr("width",c).attr("height",l).attr("y",-l/2).attr("x",0).attr("fill","transparent"),n.append("rect").attr("width",u).attr("height",d).attr("rx",5).attr("ry",5).attr("x",0).attr("y",-4).attr("fill","#E1E5EC").attr("cursor","pointer").on("click",m),p(),f}function p(){r=Object(ce["a"])(n,"g","slider-thumb",c).attr("transform",(function(e){return"translate(".concat(l(e.value)+d,", 0)")})).call(Object(he["a"])().on("drag",m)),Object(ce["a"])(r,"circle","slider-thumb-circle",(function(e){return[e]})).attr("r",11).attr("fill","#fff").attr("stroke","#ddd").attr("cursor","pointer"),Object(ce["a"])(r,"text","slider-thumb-text",(function(e){return[e]})).attr("text-anchor","middle").text((function(e){return Object(pe["a"])(e.value,c)})).attr("y",4).attr("font-size","10px").attr("pointer-events","none")}function m(e){if("object"===Object(de["a"])(e)){var t=Object(fe["a"])(s.node())[0],n=0;t<0?(t=0,n=0):t>a&&(t=a,n=u[u.length-1]);var i=Math.floor(t/l.bandwidth());e.value=u[i]||u[n];var o=l(e.value)+d,f=0;Object(oe["a"])(this).attr("transform","translate(".concat(o,",").concat(f,")")),r.selectAll(".slider-thumb-text").text((function(e){return Object(pe["a"])(e.value,c)})),h()}}return f.update=function(e){c=e,p()},f.onChange=function(e){return h=e,f},f.show=function(){e.visible=!0,t.attr("opacity",e.visible?1:0).attr("pointer-events",e.visible?"all":"none")},f.hide=function(){e.visible=!1,t.attr("opacity",e.visible?1:0).attr("pointer-events",e.visible?"all":"none")},f()}var be=me,ge=r("1b92"),ve=r("a39d");function ye(e){var t,r,n,s,a,i,o,c,l,u=e.width||520,d=e.height||250,h={top:30,right:15,bottom:65,left:65},f=e.data,p=e.sections||[],m=e.fieldName,b=e.container||document.body,g=e.xExtent,v=e.yExtent;e.currentValue;function y(){b=Object(oe["a"])(b),l=u-h.left-h.right,c=d-h.top-h.bottom;var v=f.map((function(e){return e.criteria})).sort((function(e,t){return e-t})),w=v.filter((function(e){return e%5===0}));i=Object(ue["a"])().domain(v).range([0,l]),o=Object(ue["b"])().domain(e.yDomain||[0,Object(ie["a"])(f,(function(e){return e.sum}))]).range([c,0]).nice().clamp(!0),r=Object(ce["a"])(b,"svg","simple-histogram").attr("width",u).attr("height",d),n=Object(ce["a"])(r,"g","histogram").attr("pointer-events","none").attr("transform","translate(".concat(h.left,", ").concat(h.top,")")).attr("opacity",e.visible?1:0),_(),s=Object(ce["a"])(n,"g","sections-group"),Object(ce["a"])(n,"text","x-axis-title").attr("transform","translate(\n                ".concat(l/2,", ").concat(c+h.bottom/2+16,"\n            )")).style("text-anchor","middle").text(m);var x=Object(ce["a"])(n,"g","x-axis").attr("transform","translate(0, ".concat(c,")")).call(Object(le["a"])(i).tickPadding(15).tickValues(w)),O=Object(ce["a"])(n,"g","y-axis").call(Object(le["b"])(o).ticks(5));return O.selectAll("path").remove(),x.selectAll("path").remove(),x.selectAll("line").remove(),n.selectAll("rect.bar").data(f).join("rect").attr("class","bar").attr("x",(function(e){return i(e.criteria)+.5})).attr("y",(function(e){return o(e.sum)})).attr("width",i.bandwidth()-1).attr("height",(function(e){return o(0)-o(e.sum)})).attr("fill",ge["b"].notAccepted),t=function(){},a=be({container:n,value:0,visible:!0,x:0,y:c+8,width:l,sections:p,scale:i}).onChange((function(){var e=Object(ne["a"])(g,2),t=e[0],r=e[1];p.forEach((function(e){e.value=Math.max(t,Math.min(r,e.value))})),Object(ve["a"])({chart:s,sections:p,xScale:i,height:d-20,margin:h,translateY:-20})})),p.length&&Object(ve["a"])({chart:s,sections:p,xScale:i,height:d-20,margin:h,translateY:-20}),y}function _(){var e=Object(ne["a"])(g,2),t=e[0],r=e[1],s={x1:i(t),x2:i(r)+i.bandwidth(),y:v?o(v[1]):0};n.selectAll("rect.boundary").data([s]).join("rect").attr("class","boundary").attr("x",(function(e){return e.x1})).attr("y",(function(e){return e.y})).attr("width",(function(e){return e.x2-e.x1})).attr("height",(function(e){return c-e.y+1})).attr("fill","#f8f8f8")}return y.updateSections=function(e){p=e,Object(ve["a"])({chart:s,sections:p,xScale:i,height:d-20,margin:h,translateY:-20}),a.update(p)},y.updateXAxisExtent=function(e,t){e&&(g[0]=e),t&&(g[1]=t),_()},y.updateYAxisExtent=function(e,t){e&&(v[0]=e),t&&(v[1]=t),_()},y.update=function(e){return e,t(),y},y.onUpdate=function(e){return e,y},y.show=function(){e.visible=!0,n.attr("opacity",e.visible?1:0).attr("pointer-events",e.visible?"all":"none")},y.hide=function(){e.visible=!1,n.attr("opacity",e.visible?1:0).attr("pointer-events",e.visible?"all":"none")},y.getSlider=function(){return a},y()}var _e=r("4971"),we=r.n(_e);function xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(r),!0).forEach((function(t){Object(i["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Me={props:{propName:{type:String,required:!0},collectionName:{type:String,required:!0},currentSections:{type:Array,required:!0}},components:{VueSlider:we.a},data:function(){return{chart:null,sectionCounter:0,sections:this.currentSections,dataYMax:0,dataYMaxRaw:0,dataMinRaw:1,dataMaxRaw:50,data:null,dataFetchedFor:null,xExtent:[1,50]}},computed:{minMax:function(){return this.data?Object(ae["a"])(this.data,(function(e){return e.criteria})):[0,0]}},methods:{formatNum:function(e){return Object(l["f"])(e)},addNewSection:function(){this.sections.push({name:se["a"][this.sectionCounter%se["a"].length],value:Math.ceil((this.minMax[1]-this.minMax[0])/2)}),this.sectionCounter++,this.chart.updateSections(this.sections)},deleteSection:function(e){var t=this.sections.indexOf(e);this.sections.splice(t,1),this.chart.updateSections(this.sections)},onSectionUpdate:function(){this.adjustSections()},adjustSections:function(){var e=Object(ne["a"])(this.xExtent,2),t=e[0],r=e[1];this.sections=this.sections.map((function(e){return Oe(Oe({},e),{},{value:Math.max(t,Math.min(r,e.value))})}))},fetchData:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$refs.chart&&(this.$refs.chart.innerHTML=""),e.next=3,R["a"].post("/api/compute/bins",{criteria:this.propName,collection:this.collectionName}).then((function(e){for(var r=Object(ae["a"])(e.data,(function(e){return+e.criteria})),n=Object(ae["a"])(e.data,(function(e){return+e.sum})),s=new Map(e.data.map((function(e){return[+e.criteria,e]}))),a=[],i=r[0];i<=r[1];i++){var o=s.get(i);a.push({criteria:i,sum:o?o.sum:0})}return t.xExtent=r,t.dataMinRaw=r[0],t.dataMaxRaw=r[1],t.dataYMax=Math.round(1.5*n[1]),t.dataYMaxRaw=Math.round(1.5*n[1]),a}));case 3:this.data=e.sent,this.dataFetchedFor=this.propName,setTimeout((function(){t.$refs.chart.innerHTML="",t.chart=ye({container:t.$refs.chart,width:t.$refs.chart.offsetWidth,height:300,data:t.data,visible:!0,fieldName:t.propName,sections:t.sections,yDomain:[0,t.dataYMaxRaw],xExtent:t.xExtent,yExtent:[0,t.dataYMax]})}),0);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),emitUpdate:function(){this.$emit("sections-updated",{sections:this.sections,xExtent:this.xExtent,yExtent:[0,this.dataYMax]})}},watch:{propName:function(){this.fetchData()},sections:{deep:!0,handler:function(){this.chart&&this.chart.updateSections(this.sections),this.emitUpdate()}},xExtent:function(e){this.adjustSections(),this.chart&&this.chart.updateXAxisExtent(e[0],e[1]),this.emitUpdate()},dataYMax:function(e){this.chart&&e&&this.chart.updateYAxisExtent(0,e),this.emitUpdate()}},mounted:function(){this.fetchData()}},Ce=Me,Ue=(r("02c0"),Object(p["a"])(Ce,te,re,!1,null,null,null)),je=Ue.exports,ke={props:{show:{type:Boolean,required:!0},field:{type:Object,required:!0},collectionName:{type:String,required:!0},sections:{type:Array,default:function(){return[]}},xExtent:{type:Array,default:function(){return[1,50]}},yExtent:{type:Array,default:function(){return[0,0]}}},components:{Sections:je,Mapviz:ee},data:function(){return{view:this.field&&"categorical"===this.field.category?"map":"sections",currentSections:this.sections,currentXExtent:this.xExtent,currentYExtent:this.yExtent,shapeFile:null}},methods:{onSave:function(){this.$emit("on-save",{sections:this.currentSections,shapeFile:this.shapeFile,xExtent:this.currentXExtent,yExtent:this.currentYExtent})},onSectionsUpdate:function(e){var t=e.sections,r=e.xExtent,n=e.yExtent;this.currentSections=t,this.currentXExtent=r,this.currentYExtent=n}},watch:{sections:function(){this.currentSections=this.sections},field:function(){this.view=this.field&&"categorical"===this.field.category?"map":"sections"}}},Se=ke,Ee=(r("6c4f"),Object(p["a"])(Se,V,W,!1,null,null,null)),Pe=Ee.exports,Ne=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"list"},e._l(e.list,(function(t,n){return r("div",{key:"item-"+n,staticClass:"list-item"},[r("div",{staticClass:"label"},[e._v(e._s(t.name))]),e._t("actions",null,{datum:t})],2)})),0)},Te=[],Ae={props:{list:{type:Array,required:!0}}},$e=Ae,De=(r("8514"),Object(p["a"])($e,Ne,Te,!1,null,"b526170a",null)),ze=De.exports,Re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"table-container"},[n("table",{staticClass:"users-table table table-sm"},[e._m(0),n("tbody",e._l(e.users,(function(t){return n("tr",{key:t._id,staticClass:"table-row"},[n("td",{staticClass:"cell"},[e._v(e._s(t.email))]),n("td",{staticClass:"cell"},[e._v(e._s(t.type))]),n("td",{staticClass:"cell"},[e._v(e._s(e.orgMap.get(t.org_id)))]),n("td",{staticClass:"cell"},[e._v(e._s(e.getAdminRights(t)))]),n("td",{staticClass:"cell"},[n("div",{staticClass:"d-flex align-items-center justify-content-end"},[n("div",{staticClass:"icon mr-2",on:{click:function(r){return e.goToUsersProfile(t)}}},[n("img",{attrs:{src:r("eba5")}})]),e.canDeleteUser(t)?n("div",{staticClass:"icon",on:{click:function(r){return e.onUserDelete(t)}}},[n("img",{attrs:{src:r("d739")}})]):e._e(),e.canUpdateUser(t)?n("div",{staticClass:"icon"},[n("b-button",{staticClass:"dots-icon",attrs:{size:"sm",variant:"primary-outline"},on:{click:function(r){return e.onMoreClick(t)}}},[n("b-icon",{attrs:{icon:"three-dots-vertical"}})],1)],1):e._e()])])])})),0)]),e.userPermissions.create_users?n("b-button",{staticClass:"button-add",attrs:{variant:"success"},on:{click:e.onAddUserClick}},[e._v("\n    "+e._s(e.userTrans.add_user)+"\n  ")]):e._e(),e.userPermissions.update_users?n("b-modal",{attrs:{size:"lg",title:e.popupTitle},scopedSlots:e._u([{key:"modal-footer",fn:function(){return[n("div",{staticClass:"w-100"},[n("b-button",{staticClass:"float-right",attrs:{variant:"success",size:"sm"},on:{click:function(t){return e.onUpdate()}}},[e._v("Update")]),n("b-button",{staticClass:"float-right mr-3",attrs:{variant:"light",size:"sm"},on:{click:function(t){return e.onEditCancel()}}},[e._v("Cancel")])],1)]},proxy:!0}],null,!1,1877743110),model:{value:e.showEditUserModal,callback:function(t){e.showEditUserModal=t},expression:"showEditUserModal"}},[n("b-form-group",{attrs:{"label-cols":"4",label:"Change user's name:","label-for":"edit-user-name"}},[n("b-form-input",{attrs:{state:""!==e.editUserModel.name,type:"text",id:"edit-user-name",required:""},model:{value:e.editUserModel.name,callback:function(t){e.$set(e.editUserModel,"name",t)},expression:"editUserModel.name"}})],1),n("b-form-group",{attrs:{"label-cols":"4",label:"Change user's lastname:","label-for":"edit-user-lastname"}},[n("b-form-input",{attrs:{state:""!==e.editUserModel.lastname,type:"text",id:"edit-user-lastname",required:""},model:{value:e.editUserModel.lastname,callback:function(t){e.$set(e.editUserModel,"lastname",t)},expression:"editUserModel.lastname"}})],1),n("b-form-group",{attrs:{"label-cols":"4",label:"Change user's type:"}},[n("b-form-select",{attrs:{options:e.userTypes,"track-by":"value",label:"text"},model:{value:e.editUserModel.type,callback:function(t){e.$set(e.editUserModel,"type",t)},expression:"editUserModel.type"}})],1),n("b-form-group",{attrs:{"label-cols":"4",label:"Change user's organization:","label-for":"edit-user-org"}},[n("b-form-select",{attrs:{disabled:e.isOrgPage,state:""!==e.editUserModel.org_id,options:e.orgOptions,id:"edit-user-org","track-by":"value",label:"text"},model:{value:e.editUserModel.org_id,callback:function(t){e.$set(e.editUserModel,"org_id",t)},expression:"editUserModel.org_id"}})],1),"admin"===e.editUserModel.type?n("b-form-group",{attrs:{"label-cols":"4",label:"Assign admin rights"}},[n("multiselect",{attrs:{options:e.orgOptions,multiple:!0,searchable:!0,"track-by":"value",label:"text"},model:{value:e.editUserModel.admin_rights,callback:function(t){e.$set(e.editUserModel,"admin_rights",t)},expression:"editUserModel.admin_rights"}})],1):e._e()],1):e._e(),n("b-modal",{attrs:{size:"lg",id:"user-modal",title:"Add New User"},scopedSlots:e._u([{key:"modal-footer",fn:function(){return[n("div",{staticClass:"w-100"},[n("b-button",{staticClass:"float-right",attrs:{variant:"success",size:"sm"},on:{click:function(t){return e.addNewUser()}}},[e._v("Add")]),n("b-button",{staticClass:"float-right mr-3",attrs:{variant:"light",size:"sm"},on:{click:function(t){return e.onAddUserCancel()}}},[e._v("Cancel")])],1)]},proxy:!0}]),model:{value:e.showNewUserModal,callback:function(t){e.showNewUserModal=t},expression:"showNewUserModal"}},[n("b-form-group",{attrs:{"label-cols":"4",label:"Enter user's email:","label-for":"add-user-email"}},[n("b-form-input",{attrs:{state:""!==e.addUserModel.email,type:"email",id:"add-user-email",required:""},model:{value:e.addUserModel.email,callback:function(t){e.$set(e.addUserModel,"email",t)},expression:"addUserModel.email"}})],1),n("b-form-group",{attrs:{"label-cols":"4",label:"Enter user's name:","label-for":"add-user-email"}},[n("b-form-input",{attrs:{state:""!==e.addUserModel.name,type:"text",id:"add-user-name",required:""},model:{value:e.addUserModel.name,callback:function(t){e.$set(e.addUserModel,"name",t)},expression:"addUserModel.name"}})],1),n("b-form-group",{attrs:{"label-cols":"4",label:"Enter user's lastname:","label-for":"add-user-email"}},[n("b-form-input",{attrs:{state:""!==e.addUserModel.lastname,type:"text",id:"add-user-lastname",required:""},model:{value:e.addUserModel.lastname,callback:function(t){e.$set(e.addUserModel,"lastname",t)},expression:"addUserModel.lastname"}})],1),n("b-form-group",{attrs:{"label-cols":"4",label:"Enter user's default password:","label-for":"add-user-password",description:"User will be forced to change the password after first login."}},[n("b-form-input",{attrs:{state:""!==e.addUserModel.password&&e.addUserModel.password.length>=8,type:"password",id:"add-user-password"},model:{value:e.addUserModel.password,callback:function(t){e.$set(e.addUserModel,"password",t)},expression:"addUserModel.password"}})],1),n("b-form-group",{attrs:{"label-cols":"4",label:"Enter user's type:","label-for":"add-user-type"}},[n("b-form-select",{attrs:{state:""!==e.addUserModel.type,options:e.userTypes,id:"add-user-type","track-by":"value",label:"text"},model:{value:e.addUserModel.type,callback:function(t){e.$set(e.addUserModel,"type",t)},expression:"addUserModel.type"}})],1),n("b-form-group",{attrs:{"label-cols":"4",label:"Enter user's organization:","label-for":"add-user-org"}},[n("b-form-select",{attrs:{disabled:e.isOrgPage,state:""!==e.addUserModel.org_id,options:e.currentUserOrgs,id:"add-user-org","track-by":"value",label:"text"},model:{value:e.addUserModel.org_id,callback:function(t){e.$set(e.addUserModel,"org_id",t)},expression:"addUserModel.org_id"}})],1),"admin"===e.addUserModel.type?n("b-form-group",{attrs:{"label-cols":"4",label:"Assign admin rights"}},[n("multiselect",{attrs:{options:e.orgOptions,multiple:!0,searchable:!0,"track-by":"value",label:"text"},model:{value:e.addUserModel.admin_rights,callback:function(t){e.$set(e.addUserModel,"admin_rights",t)},expression:"addUserModel.admin_rights"}})],1):e._e()],1)],1)},qe=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("thead",[r("tr",[r("th",[e._v("Email")]),r("th",[e._v("Type")]),r("th",[e._v("Org")]),r("th",[e._v("Admin Rights")]),r("th")])])}],Fe=r("8e5f"),Ye=r.n(Fe);function Le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(r),!0).forEach((function(t){Object(i["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Be={email:"",name:"",lastname:"",password:"",added_by_admin:!0,type:"level_1",org_id:"",admin_rights:[]},Ve={type:null,admin_rights:[],org_id:"",user_id:"",name:"",lastname:""},We={props:{users:{type:Array,required:!0}},data:function(){return{showEditUserModal:!1,showNewUserModal:!1,currentEditUser:null,editUserModel:Ve,addUserModel:Be}},components:{Multiselect:Ye.a},computed:Ie(Ie(Ie({},Object(o["c"])(["userPermissions","currentUser"])),Object(o["d"])({user:function(e){return e.auth.user},userTrans:function(e){return e.lang.userTrans},orgs:function(e){return e.auth.orgs||[]}})),{},{isOrgPage:function(){return this.$route.params.ref_id!==this.currentUser._id},popupTitle:function(){return this.currentEditUser?"".concat(this.currentEditUser.email,"'s settings"):""},userTypes:function(){var e="admin"===this.currentUser.type,t="super_admin"===this.currentUser.type,r=[{text:"level_1",value:"level_1"},{text:"level_2",value:"level_2"},{text:"level_3",value:"level_3"}];return e?r:t?[].concat(r,[{text:"admin",value:"admin"},{text:"super_admin",value:"super_admin"}]):[]},orgOptions:function(){return this.orgs.map((function(e){return{text:e.name,value:e._id}}))},currentUserOrgs:function(){if("super_admin"===this.currentUser.type)return this.orgOptions;var e=this.currentUser.admin_rights;return this.orgOptions.filter((function(t){return e.indexOf(t.value)>-1}))},orgMap:function(){return new Map(this.orgs.map((function(e){return[e._id,e.name]})))}}),methods:Ie(Ie({},Object(o["b"])(["createUser","deleteUser","updateUser","browseUser","fetchOrgs"])),{},{getAdminRights:function(e){var t=this;return e.admin_rights.map((function(e){return t.orgMap.get(e)})).filter((function(e){return e})).join(", ")},onAddUserClick:function(){this.isOrgPage&&(this.addUserModel.org_id=this.$route.params.ref_id),this.showNewUserModal=!0},addNewUser:function(){var e=this;if(this.userPermissions.create_users){var t=this.addUserModel,r=t.email,n=t.name,s=t.lastname,a=t.password,i=t.type,o=t.org_id,c=t.admin_rights;""!==r&&""!==n&&""!==s&&a.length>=8&&""!==i&&""!==o&&Array.isArray(c)&&R["a"].get("/api/orgs/find-one?user_count=1&org_id="+o).then((function(t){var r=t.data;if(!(r.user_count<r.attrs.max_users))throw new Error("User limit reached");var n=Ie(Ie({},e.addUserModel),{},{admin_rights:c.map((function(e){return e.value}))});e.createUser(n).then(e.onAddUserCancel)})).catch((function(t){e.flash(t.message,"error")}))}},onAddUserCancel:function(){this.showNewUserModal=!1,this.addUserModel=Be},onUserDelete:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.userPermissions.delete_users){e.next=5;break}return e.next=3,this.$dialog.confirm({title:"Are you sure you want to delete this user?",text:"This user will be removed permanently and can't be restored!"});case 3:r=e.sent,r&&this.deleteUser(t._id);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),goToUsersProfile:function(e){this.browseUser(e)},onUpdate:function(){if(this.userPermissions.update_users){var e=this.editUserModel,t=e.user_id,r=e.org_id,n=e.admin_rights,s=e.type;if(""!==r&&Array.isArray(n)&&""!==s&&""!==t){var a=Ie(Ie({},this.editUserModel),{},{admin_rights:n.map((function(e){return e.value}))});this.updateUser(a).then(this.onEditCancel)}}},onEditCancel:function(){this.currentEditUser=null,this.showEditUserModal=!1,this.editUserModel=Ve},onMoreClick:function(e){var t=this;this.currentEditUser=e,this.editUserModel.admin_rights=e.admin_rights.map((function(e){return{text:t.orgMap.get(e),value:e}})),this.editUserModel.type=e.type,this.editUserModel.org_id=e.org_id,this.editUserModel.user_id=e._id,this.editUserModel.name=e.name||"",this.editUserModel.lastname=e.lastname||"",this.showEditUserModal=!0},loadOrgs:function(){var e={};"admin"===this.currentUser.type&&(e.admin_rights=this.currentUser.admin_rights),this.fetchOrgs(e)},canDeleteUser:function(e){if(!this.userPermissions.delete_users)return!1;if("super_admin"!==e.type){if("super_admin"===this.user.type)return!0;if("admin"===this.user.type)return"admin"!==e.type}return!1},canUpdateUser:function(e){if(!this.userPermissions.update_users)return!1;if("super_admin"!==e.type){if("super_admin"===this.user.type)return!0;if("admin"===this.user.type)return"admin"!==e.type}else if(this.user.email===e.email&&"super_admin"===this.user.type)return!0;return!1}}),watch:{currentUser:function(){this.loadOrgs()}},created:function(){0===this.orgs.length&&this.loadOrgs()}},Xe=We,He=(r("7b11"),Object(p["a"])(Xe,Re,qe,!1,null,"c078aa96",null)),Je=He.exports,Ge=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-modal",{attrs:{size:"lg",id:"copy-modal",title:"Copy scheme"},scopedSlots:e._u([{key:"modal-footer",fn:function(){return[r("div",{staticClass:"w-100"},[r("b-button",{staticClass:"float-right",attrs:{variant:"success",size:"sm"},on:{click:function(t){return e.onCopySchemes()}}},[e._v("Copy")]),r("b-button",{staticClass:"float-right mr-3",attrs:{variant:"light",size:"sm"},on:{click:e.onCancel}},[e._v("Cancel")])],1)]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[r("b-form-group",{attrs:{"label-cols-sm":"5","label-cols-lg":"5",label:"Copy to:"}},[r("b-form-select",{attrs:{options:e.copyToOptions},model:{value:e.userTo,callback:function(t){e.userTo=t},expression:"userTo"}})],1),r("b-form-group",{attrs:{"label-cols-sm":"5","label-cols-lg":"5",label:"Scheme to copy:"}},[r("multiselect",{attrs:{options:e.schemeList,multiple:!0,label:"name","track-by":"id"},model:{value:e.selectedSchemes,callback:function(t){e.selectedSchemes=t},expression:"selectedSchemes"}})],1)],1)},Ze=[];function Ke(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(r),!0).forEach((function(t){Object(i["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ke(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var et={props:{show:{type:Boolean,required:!0},org:{type:Object,required:!1}},components:{Multiselect:Ye.a},data:function(){return{userTo:null,selectedSchemes:[]}},computed:Qe(Qe(Qe({},Object(o["c"])(["currentUser"])),Object(o["d"])({users:function(e){return e.admin.users},schemeList:function(e){var t=e.scheme;return t.schemeList}})),{},{isOrgPage:function(){return this.$route.params.ref_id!==this.currentUser._id},copyToOptions:function(){var e=this.users.map((function(e){return{text:e.email,value:e._id}}));return this.isOrgPage?e:e.concat([{value:this.currentUser.org_id,text:this.org?this.org.name:"current org"}])}}),methods:Qe(Qe({},Object(o["b"])(["copyUserSchemes"])),{},{onCopySchemes:function(){var e=this,t=this.$route.params.ref_id,r=this.selectedSchemes;if(t&&this.userTo&&r.length>0){var n=r.map((function(e){return e.id}));this.copyUserSchemes({userFromId:t,userToId:this.userTo,selectedSchemeIds:n}).then((function(t){t?e.flash("Scheme(s) Copied","success",{timeout:3e3}):e.flash("Error","error",{timeout:3e3}),e.onCancel()})).catch((function(){e.flash("Error","error",{timeout:3e3})}))}},onCancel:function(){this.userTo=null,this.selectedSchemes=[],this.$emit("on-cancel")}})},tt=et,rt=Object(p["a"])(tt,Ge,Ze,!1,null,null,null),nt=rt.exports;function st(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function at(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?st(Object(r),!0).forEach((function(t){Object(i["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):st(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var it={props:["ref_id"],data:function(){return{currentCollection:null,showDatasetModal:!1,showSchemeModal:!1,showMoreModal:!1,showCopySchemes:!1,sectionMap:{},currentModalVariable:null,sections:[],xExtent:[],yExtent:[],org:null}},components:{BlockContainer:c["a"],SchemeModal:b,DatasetModal:B,MoreModal:Pe,List:ze,UsersTable:Je,CopySchemes:nt},computed:at(at(at({},Object(o["c"])(["userPermissions","userSettings","currentUser"])),Object(o["d"])({users:function(e){return e.admin.users},userTrans:function(e){return e.lang.userTrans},schemeList:function(e){var t=e.scheme;return t.schemeList},collectionList:function(e){var t=e.scheme;return t.collectionList}})),{},{currentUserName:function(){var e=this.currentUser,t=e.name,r=e.lastname,n=e.email;return t&&r?t+" "+r:n},showUsers:function(){return this.isOrgPage&&("admin"===this.currentUser.type||"super_admin"===this.currentUser.type)},isOrgPage:function(){return this.ref_id!==this.currentUser._id},org_id:function(){return this.isOrgPage?this.ref_id:this.currentUser.org_id}}),methods:at(at({},Object(o["b"])(["removeCollection","removeTargetingScheme","browsePopulationPage","listSchemes","listUsers"])),{},{onMoreClick:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.currentModalVariable=t,this.showMoreModal=!0,r=this.sectionMap[t.propName],r?(this.sections=r.sections,this.xExtent=r.xExtent,this.yExtent=r.yExtent):(this.sections=[],this.xExtent=[1,50],this.yExtent=[0,0]);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),deleteScheme:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$dialog.prompt({text:"",title:"Are you sure you want to delete scheme ".concat(t.name,"? \n        If so, please type below '").concat(t.name,"'")});case 2:r=e.sent,r==t.name&&this.removeTargetingScheme({user_id:this.ref_id,scheme_id:t.id});case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),deleteDataset:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r,n,s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.split("_"),n="",n=isNaN(r[1])||13!==r[1].length?r.slice(1,r.length-1).join("_"):r.slice(2).join("_"),e.next=5,this.$dialog.prompt({text:"",title:"Are you sure you want to delete dataset ".concat(n,"? \n        If so, please type below '").concat(n,"'")});case 5:s=e.sent,a=[],a=isNaN(r[1])||13!==r[1].length?[r[0],s,r[r.length-1]]:[r[0],r[1],s],a.join("_")===t&&this.removeCollection({collection:t,user_id:this.ref_id});case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),addMoreScheme:function(){var e=this.userSettings.max_targeting_schemes,t=this.schemeList.length;if(t+1>e)return this.showSchemeModal=!1,this.flash("You are only allowed to have ".concat(e," schemes"),"error");this.showSchemeModal=!0},addMoreDataset:function(){var e=this.userSettings.max_datasets,t=this.collectionList.length;if(t+1>e)return this.showDatasetModal=!1,this.flash("You are only allowed to have ".concat(e," datasets"),"error");this.showDatasetModal=!0},onMoreModalSave:function(e){var t=e.sections,r=e.shapeFile,n=e.xExtent,s=e.yExtent;this.sectionMap[this.currentModalVariable.propName]={sections:t.map((function(e){return{name:e.name,value:+e.value}})),xExtent:n,yExtent:s,variable:this.currentModalVariable.propName,shapeFile:r},this.showMoreModal=!1},onDatasetUploaded:function(e){var t=e.collection;this.currentCollection=t},onDatasetCancel:function(){this.showDatasetModal=!1,this.data=null,this.dataFetchedFor=null,this.currentCollection=null},goToYourPopulation:function(e,t){var r="/scenarios/".concat(this.ref_id);this.userPermissions.update_schemes?(this.browsePopulationPage({id:e,name:t}),this.$router.push("".concat(r,"/specifications/").concat(e))):this.$router.push("".concat(r,"/tree/").concat(e))},onSchemeSave:function(e){var t=Object(l["e"])();this.goToYourPopulation(t,e)},loadOrg:function(e){var t=this;e&&(this.org=null,R["a"].get("/api/orgs/find-one?org_id="+e).then((function(e){t.org=e.data})).catch((function(){})))},init:function(){this.listSchemes(this.ref_id),this.loadOrg(this.org_id),(this.userPermissions.copy_schemes||this.showUsers)&&this.listUsers({org_id:this.org_id})}}),watch:{currentUser:function(){this.init()}},created:function(){this.init()}},ot=it,ct=(r("213c"),Object(p["a"])(ot,n,s,!1,null,null,null));t["default"]=ct.exports},"55dd":function(e,t,r){"use strict";var n=r("5ca1"),s=r("d8e8"),a=r("4bf8"),i=r("79e5"),o=[].sort,c=[1,2,3];n(n.P+n.F*(i((function(){c.sort(void 0)}))||!i((function(){c.sort(null)}))||!r("2f21")(o)),"Array",{sort:function(e){return void 0===e?o.call(a(this)):o.call(a(this),s(e))}})},"5ccb":function(e,t,r){var n=r("9a15");function s(e,t){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(a(s,t)),e;case"Feature":return e.geometry=s(e.geometry,t),e;case"Polygon":case"MultiPolygon":return i(e,t);default:return e}}function a(e,t){return function(r){return e(r,t)}}function i(e,t){return"Polygon"===e.type?e.coordinates=o(e.coordinates,t):"MultiPolygon"===e.type&&(e.coordinates=e.coordinates.map(a(o,t))),e}function o(e,t){t=!!t,e[0]=c(e[0],t);for(var r=1;r<e.length;r++)e[r]=c(e[r],!t);return e}function c(e,t){return l(e)===t?e:e.reverse()}function l(e){return n.ring(e)>=0}e.exports=s},"5d73":function(e,t,r){e.exports=r("469f")},"64af":function(e,t){e.exports.RADIUS=6378137,e.exports.FLATTENING=1/298.257223563,e.exports.POLAR_RADIUS=6356752.3142},"6c4f":function(e,t,r){"use strict";var n=r("ed9d"),s=r.n(n);s.a},"768b":function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var n=r("a745"),s=r.n(n);function a(e){if(s()(e))return e}var i=r("5d73"),o=r.n(i),c=r("c8bb"),l=r.n(c),u=r("67bb"),d=r.n(u);function h(e,t){if("undefined"!==typeof d.a&&l()(Object(e))){var r=[],n=!0,s=!1,a=void 0;try{for(var i,c=o()(e);!(n=(i=c.next()).done);n=!0)if(r.push(i.value),t&&r.length===t)break}catch(u){s=!0,a=u}finally{try{n||null==c["return"]||c["return"]()}finally{if(s)throw a}}return r}}var f=r("e630");function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e,t){return a(e)||h(e,t)||Object(f["a"])(e,t)||p()}},"7b11":function(e,t,r){"use strict";var n=r("ffd1"),s=r.n(n);s.a},"7d7b":function(e,t,r){var n=r("e4ae"),s=r("7cd6");e.exports=r("584a").getIterator=function(e){var t=s(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},"7f8c":function(e,t,r){"use strict";r("8e6e"),r("ac6a"),r("456d");var n=r("bd86"),s=r("2f62");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){Object(n["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t["a"]={computed:i({},Object(s["d"])({userTrans:function(e){return e.lang.userTrans}}))}},"823f":function(e,t,r){"use strict";function n(e,t){let r;if(void 0===t)for(const n of e)null!=n&&(r<n||void 0===r&&n>=n)&&(r=n);else{let n=-1;for(let s of e)null!=(s=t(s,++n,e))&&(r<s||void 0===r&&s>=s)&&(r=s)}return r}r.d(t,"a",(function(){return n}))},8514:function(e,t,r){"use strict";var n=r("adae"),s=r.n(n);s.a},"928a":function(e,t,r){},"9a15":function(e,t,r){var n=r("64af");function s(e){var t,r=0;switch(e.type){case"Polygon":return a(e.coordinates);case"MultiPolygon":for(t=0;t<e.coordinates.length;t++)r+=a(e.coordinates[t]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(t=0;t<e.geometries.length;t++)r+=s(e.geometries[t]);return r}}function a(e){var t=0;if(e&&e.length>0){t+=Math.abs(i(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(i(e[r]))}return t}function i(e){var t,r,s,a,i,c,l,u=0,d=e.length;if(d>2){for(l=0;l<d;l++)l===d-2?(a=d-2,i=d-1,c=0):l===d-1?(a=d-1,i=0,c=1):(a=l,i=l+1,c=l+2),t=e[a],r=e[i],s=e[c],u+=(o(s[0])-o(t[0]))*Math.sin(o(r[1]));u=u*n.RADIUS*n.RADIUS/2}return u}function o(e){return e*Math.PI/180}e.exports.geometry=s,e.exports.ring=i},adae:function(e,t,r){},affe:function(e,t,r){"use strict";var n=r("928a"),s=r.n(n);s.a},b304:function(e,t,r){},bc0a:function(e,t,r){},eba5:function(e,t,r){e.exports=r.p+"img/go_to.a10b9bde.png"},ed9d:function(e,t,r){},f51c:function(e,t,r){e.exports=r.p+"img/more.273dd99f.svg"},ffd1:function(e,t,r){}}]);